'use strict';

var obsidian = require('obsidian');
var fs = require('fs');
var path = require('path');
var child_process = require('child_process');

// @ts-nocheck
// Custom logger with levels
class Logger {
    static debug(message, ...args) {
        if (Logger.level <= Logger.DEBUG) {
            console.debug(`[${Logger.prefix}] ${message}`, ...args);
        }
    }
    static info(message, ...args) {
        if (Logger.level <= Logger.INFO) {
            console.info(`[${Logger.prefix}] ${message}`, ...args);
        }
    }
    static warn(message, ...args) {
        if (Logger.level <= Logger.WARN) {
            console.warn(`[${Logger.prefix}] ${message}`, ...args);
        }
    }
    static error(message, ...args) {
        if (Logger.level <= Logger.ERROR) {
            console.error(`[${Logger.prefix}] ${message}`, ...args);
        }
    }
}
Logger.DEBUG = 0;
Logger.INFO = 1;
Logger.WARN = 2;
Logger.ERROR = 3;
Logger.level = Logger.DEBUG; // Set minimum log level
Logger.prefix = "EditNext";
const DEFAULT_SETTINGS = {
    openaiApiKey: '',
    pythonPath: 'python3',
    weights: [0.6, 0.2, 0.2],
    model: 'gpt-4o-mini',
    targetFolder: '',
};
// --------------------------------------------------
// Helper to run external python process
// --------------------------------------------------
async function runRanker(app, settings) {
    return new Promise((resolve, reject) => {
        // Determine folder absolute path
        const vaultPath = app.vault.adapter.getBasePath();
        const targetDir = settings.targetFolder
            ? path.join(vaultPath, obsidian.normalizePath(settings.targetFolder))
            : vaultPath;
        Logger.debug("Running ranker with settings:", settings);
        Logger.debug("Target directory:", targetDir);
        // Ensure directory exists
        if (!fs.existsSync(targetDir)) {
            const error = `Target directory not found: ${targetDir}`;
            Logger.error(error);
            reject(new Error(error));
            return;
        }
        // Compose command
        const scriptPath = path.join(__dirname, '..', '..', 'editnext', 'essay-quality-ranker.py');
        Logger.debug("Script path:", scriptPath);
        // Check if script exists
        if (!fs.existsSync(scriptPath)) {
            const error = `Script not found: ${scriptPath}`;
            Logger.error(error);
            reject(new Error(error));
            return;
        }
        const cmdArgs = [
            scriptPath,
            targetDir,
            '--weights',
            ...settings.weights.map((w) => w.toString()),
            '--model',
            settings.model,
        ];
        Logger.debug("Command:", settings.pythonPath, cmdArgs.join(' '));
        // Provide environment
        const env = { ...process.env, OPENAI_API_KEY: settings.openaiApiKey };
        Logger.debug("API key set:", !!settings.openaiApiKey);
        // Spawn child process
        try {
            const child = child_process.spawn(settings.pythonPath, cmdArgs, { env });
            let output = '';
            let errorOutput = '';
            child.stdout.on('data', (data) => {
                const chunk = data.toString();
                Logger.debug(`Python stdout: ${chunk}`);
                output += chunk;
            });
            child.stderr.on('data', (data) => {
                const chunk = data.toString();
                Logger.error(`Python stderr: ${chunk}`);
                errorOutput += chunk;
            });
            child.on('error', (err) => {
                Logger.error("Process error:", err);
                reject(err);
            });
            child.on('close', (code) => {
                Logger.debug(`Process exited with code ${code}`);
                if (code === 0) {
                    resolve(output);
                }
                else {
                    const error = `Process exited with code ${code}${errorOutput ? ': ' + errorOutput : ''}`;
                    Logger.error(error);
                    reject(new Error(error));
                }
            });
        }
        catch (err) {
            Logger.error("Failed to spawn process:", err);
            reject(err);
        }
    });
}
// --------------------------------------------------
// Plugin implementation
// --------------------------------------------------
class EditNextPlugin extends obsidian.Plugin {
    constructor() {
        super(...arguments);
        this.settings = DEFAULT_SETTINGS;
    }
    async onload() {
        Logger.info('Loading EditNext Ranker plugin');
        try {
            // Log plugin details
            Logger.debug("Plugin directory:", this.manifest.dir);
            Logger.debug("Plugin version:", this.manifest.version);
            await this.loadSettings();
            Logger.debug("Settings loaded:", this.settings);
            // Register command
            // @ts-ignore
            this.addCommand({
                id: 'editnext-rank-files',
                name: 'Rank files by editing effort',
                callback: async () => {
                    Logger.info('Running EditNext ranker command...');
                    new obsidian.Notice('Running EditNext ranker...');
                    try {
                        const result = await runRanker(this.app, this.settings);
                        Logger.debug("Ranker completed successfully");
                        // Show output in a new pane
                        // @ts-ignore
                        const leaf = this.app.workspace.getLeaf(true);
                        await leaf.open(new EditNextResultView(leaf, result));
                    }
                    catch (err) {
                        const errorMsg = err.message;
                        Logger.error("Ranker error:", err);
                        new obsidian.Notice(`EditNext error: ${errorMsg}`);
                    }
                },
            });
            // Add settings tab
            // @ts-ignore
            this.addSettingTab(new EditNextSettingTab(this.app, this));
            Logger.info('EditNext Ranker plugin loaded successfully');
        }
        catch (err) {
            Logger.error("Error during plugin load:", err);
            throw err; // Re-throw to let Obsidian handle it
        }
    }
    onunload() {
        Logger.info('Unloading EditNext Ranker plugin');
    }
    async loadSettings() {
        try {
            const savedData = await this.loadData();
            Logger.debug("Loaded saved data:", savedData);
            this.settings = Object.assign({}, DEFAULT_SETTINGS, savedData);
        }
        catch (err) {
            Logger.error("Failed to load settings:", err);
            this.settings = { ...DEFAULT_SETTINGS };
        }
    }
    async saveSettings() {
        try {
            await this.saveData(this.settings);
            Logger.debug("Settings saved successfully");
        }
        catch (err) {
            Logger.error("Failed to save settings:", err);
        }
    }
}
const VIEW_TYPE = 'editnext-results';
class EditNextResultView extends obsidian.ItemView {
    constructor(leaf, text) {
        super(leaf);
        this.resultText = text;
    }
    getViewType() {
        return VIEW_TYPE;
    }
    getDisplayText() {
        return 'EditNext Results';
    }
    async onOpen() {
        const container = this.containerEl.children[1];
        container.empty();
        const pre = container.createEl('pre');
        pre.style.whiteSpace = 'pre-wrap';
        pre.setText(this.resultText);
    }
    async onClose() { }
}
// --------------------------------------------------
// Settings Tab UI
// --------------------------------------------------
class EditNextSettingTab extends obsidian.PluginSettingTab {
    constructor(app, plugin) {
        super(app, plugin);
        this.plugin = plugin;
        Logger.debug("Settings tab initialized");
    }
    display() {
        const { containerEl } = this;
        Logger.debug("Settings tab displayed");
        containerEl.empty();
        containerEl.createEl('h2', { text: 'EditNext Ranker Settings' });
        new obsidian.Setting(containerEl)
            .setName('OpenAI API Key')
            .setDesc('Required to query GPT models')
            .addText((text) => text
            .setPlaceholder('sk-XXXX')
            .setValue(this.plugin.settings.openaiApiKey)
            .onChange(async (value) => {
            this.plugin.settings.openaiApiKey = value.trim();
            await this.plugin.saveSettings();
        }));
        new obsidian.Setting(containerEl)
            .setName('Python Path')
            .setDesc('Path to Python executable (with dependencies installed)')
            .addText((text) => text
            .setPlaceholder('python3')
            .setValue(this.plugin.settings.pythonPath)
            .onChange(async (value) => {
            this.plugin.settings.pythonPath = value.trim() || 'python3';
            await this.plugin.saveSettings();
        }));
        new obsidian.Setting(containerEl)
            .setName('Weights')
            .setDesc('Three numbers for LLM, Grammar, Readability weights (sum 1.0)')
            .addText((text) => text
            .setPlaceholder('0.6 0.2 0.2')
            .setValue(this.plugin.settings.weights.join(' '))
            .onChange(async (value) => {
            const parts = value.split(/\s+/).map(Number);
            if (parts.length === 3 && parts.every((n) => !isNaN(n))) {
                this.plugin.settings.weights = parts;
                await this.plugin.saveSettings();
            }
        }));
        new obsidian.Setting(containerEl)
            .setName('OpenAI Model')
            .setDesc('Model to use for scoring')
            .addText((text) => text.setPlaceholder('gpt-4o-mini').setValue(this.plugin.settings.model).onChange(async (value) => {
            this.plugin.settings.model = value.trim();
            await this.plugin.saveSettings();
        }));
        new obsidian.Setting(containerEl)
            .setName('Target Folder')
            .setDesc('Relative path inside vault; leave blank for entire vault')
            .addText((text) => text
            .setPlaceholder('drafts')
            .setValue(this.plugin.settings.targetFolder)
            .onChange(async (value) => {
            this.plugin.settings.targetFolder = value.trim();
            await this.plugin.saveSettings();
        }));
    }
}

module.exports = EditNextPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsiLi4vc3JjL21haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLW5vY2hlY2tcbmltcG9ydCB7IFBsdWdpbiwgTm90aWNlLCBBcHAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIG5vcm1hbGl6ZVBhdGggfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBzcGF3biB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuXG4vLyBDdXN0b20gbG9nZ2VyIHdpdGggbGV2ZWxzXG5jbGFzcyBMb2dnZXIge1xuICBzdGF0aWMgREVCVUcgPSAwO1xuICBzdGF0aWMgSU5GTyA9IDE7XG4gIHN0YXRpYyBXQVJOID0gMjtcbiAgc3RhdGljIEVSUk9SID0gMztcbiAgXG4gIHN0YXRpYyBsZXZlbCA9IExvZ2dlci5ERUJVRzsgLy8gU2V0IG1pbmltdW0gbG9nIGxldmVsXG4gIHN0YXRpYyBwcmVmaXggPSBcIkVkaXROZXh0XCI7XG4gIFxuICBzdGF0aWMgZGVidWcobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSkge1xuICAgIGlmIChMb2dnZXIubGV2ZWwgPD0gTG9nZ2VyLkRFQlVHKSB7XG4gICAgICBjb25zb2xlLmRlYnVnKGBbJHtMb2dnZXIucHJlZml4fV0gJHttZXNzYWdlfWAsIC4uLmFyZ3MpO1xuICAgIH1cbiAgfVxuICBcbiAgc3RhdGljIGluZm8obWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSkge1xuICAgIGlmIChMb2dnZXIubGV2ZWwgPD0gTG9nZ2VyLklORk8pIHtcbiAgICAgIGNvbnNvbGUuaW5mbyhgWyR7TG9nZ2VyLnByZWZpeH1dICR7bWVzc2FnZX1gLCAuLi5hcmdzKTtcbiAgICB9XG4gIH1cbiAgXG4gIHN0YXRpYyB3YXJuKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogYW55W10pIHtcbiAgICBpZiAoTG9nZ2VyLmxldmVsIDw9IExvZ2dlci5XQVJOKSB7XG4gICAgICBjb25zb2xlLndhcm4oYFske0xvZ2dlci5wcmVmaXh9XSAke21lc3NhZ2V9YCwgLi4uYXJncyk7XG4gICAgfVxuICB9XG4gIFxuICBzdGF0aWMgZXJyb3IobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSkge1xuICAgIGlmIChMb2dnZXIubGV2ZWwgPD0gTG9nZ2VyLkVSUk9SKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBbJHtMb2dnZXIucHJlZml4fV0gJHttZXNzYWdlfWAsIC4uLmFyZ3MpO1xuICAgIH1cbiAgfVxufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gU2V0dGluZ3MgZGVmaW5pdGlvblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmludGVyZmFjZSBFZGl0TmV4dFBsdWdpblNldHRpbmdzIHtcbiAgb3BlbmFpQXBpS2V5OiBzdHJpbmc7XG4gIHB5dGhvblBhdGg6IHN0cmluZztcbiAgd2VpZ2h0czogW251bWJlciwgbnVtYmVyLCBudW1iZXJdO1xuICBtb2RlbDogc3RyaW5nO1xuICB0YXJnZXRGb2xkZXI6IHN0cmluZzsgLy8gcmVsYXRpdmUgdG8gdmF1bHQgcm9vdFxufVxuXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBFZGl0TmV4dFBsdWdpblNldHRpbmdzID0ge1xuICBvcGVuYWlBcGlLZXk6ICcnLFxuICBweXRob25QYXRoOiAncHl0aG9uMycsXG4gIHdlaWdodHM6IFswLjYsIDAuMiwgMC4yXSxcbiAgbW9kZWw6ICdncHQtNG8tbWluaScsXG4gIHRhcmdldEZvbGRlcjogJycsXG59O1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gSGVscGVyIHRvIHJ1biBleHRlcm5hbCBweXRob24gcHJvY2Vzc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmFzeW5jIGZ1bmN0aW9uIHJ1blJhbmtlcihhcHA6IEFwcCwgc2V0dGluZ3M6IEVkaXROZXh0UGx1Z2luU2V0dGluZ3MpOiBQcm9taXNlPHN0cmluZz4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIC8vIERldGVybWluZSBmb2xkZXIgYWJzb2x1dGUgcGF0aFxuICAgIGNvbnN0IHZhdWx0UGF0aCA9IGFwcC52YXVsdC5hZGFwdGVyLmdldEJhc2VQYXRoKCk7XG4gICAgY29uc3QgdGFyZ2V0RGlyID0gc2V0dGluZ3MudGFyZ2V0Rm9sZGVyXG4gICAgICA/IHBhdGguam9pbih2YXVsdFBhdGgsIG5vcm1hbGl6ZVBhdGgoc2V0dGluZ3MudGFyZ2V0Rm9sZGVyKSlcbiAgICAgIDogdmF1bHRQYXRoO1xuICAgIFxuICAgIExvZ2dlci5kZWJ1ZyhcIlJ1bm5pbmcgcmFua2VyIHdpdGggc2V0dGluZ3M6XCIsIHNldHRpbmdzKTtcbiAgICBMb2dnZXIuZGVidWcoXCJUYXJnZXQgZGlyZWN0b3J5OlwiLCB0YXJnZXREaXIpO1xuXG4gICAgLy8gRW5zdXJlIGRpcmVjdG9yeSBleGlzdHNcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmModGFyZ2V0RGlyKSkge1xuICAgICAgY29uc3QgZXJyb3IgPSBgVGFyZ2V0IGRpcmVjdG9yeSBub3QgZm91bmQ6ICR7dGFyZ2V0RGlyfWA7XG4gICAgICBMb2dnZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgcmVqZWN0KG5ldyBFcnJvcihlcnJvcikpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENvbXBvc2UgY29tbWFuZFxuICAgIGNvbnN0IHNjcmlwdFBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnZWRpdG5leHQnLCAnZXNzYXktcXVhbGl0eS1yYW5rZXIucHknKTtcbiAgICBMb2dnZXIuZGVidWcoXCJTY3JpcHQgcGF0aDpcIiwgc2NyaXB0UGF0aCk7XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgc2NyaXB0IGV4aXN0c1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhzY3JpcHRQYXRoKSkge1xuICAgICAgY29uc3QgZXJyb3IgPSBgU2NyaXB0IG5vdCBmb3VuZDogJHtzY3JpcHRQYXRofWA7XG4gICAgICBMb2dnZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgcmVqZWN0KG5ldyBFcnJvcihlcnJvcikpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBjbWRBcmdzOiBzdHJpbmdbXSA9IFtcbiAgICAgIHNjcmlwdFBhdGgsXG4gICAgICB0YXJnZXREaXIsXG4gICAgICAnLS13ZWlnaHRzJyxcbiAgICAgIC4uLnNldHRpbmdzLndlaWdodHMubWFwKCh3KSA9PiB3LnRvU3RyaW5nKCkpLFxuICAgICAgJy0tbW9kZWwnLFxuICAgICAgc2V0dGluZ3MubW9kZWwsXG4gICAgXTtcbiAgICBcbiAgICBMb2dnZXIuZGVidWcoXCJDb21tYW5kOlwiLCBzZXR0aW5ncy5weXRob25QYXRoLCBjbWRBcmdzLmpvaW4oJyAnKSk7XG5cbiAgICAvLyBQcm92aWRlIGVudmlyb25tZW50XG4gICAgY29uc3QgZW52ID0geyAuLi5wcm9jZXNzLmVudiwgT1BFTkFJX0FQSV9LRVk6IHNldHRpbmdzLm9wZW5haUFwaUtleSB9O1xuICAgIExvZ2dlci5kZWJ1ZyhcIkFQSSBrZXkgc2V0OlwiLCAhIXNldHRpbmdzLm9wZW5haUFwaUtleSk7XG5cbiAgICAvLyBTcGF3biBjaGlsZCBwcm9jZXNzXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNoaWxkID0gc3Bhd24oc2V0dGluZ3MucHl0aG9uUGF0aCwgY21kQXJncywgeyBlbnYgfSk7XG5cbiAgICAgIGxldCBvdXRwdXQgPSAnJztcbiAgICAgIGxldCBlcnJvck91dHB1dCA9ICcnO1xuICAgICAgXG4gICAgICBjaGlsZC5zdGRvdXQub24oJ2RhdGEnLCAoZGF0YTogQnVmZmVyKSA9PiB7XG4gICAgICAgIGNvbnN0IGNodW5rID0gZGF0YS50b1N0cmluZygpO1xuICAgICAgICBMb2dnZXIuZGVidWcoYFB5dGhvbiBzdGRvdXQ6ICR7Y2h1bmt9YCk7XG4gICAgICAgIG91dHB1dCArPSBjaHVuaztcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjaGlsZC5zdGRlcnIub24oJ2RhdGEnLCAoZGF0YTogQnVmZmVyKSA9PiB7XG4gICAgICAgIGNvbnN0IGNodW5rID0gZGF0YS50b1N0cmluZygpO1xuICAgICAgICBMb2dnZXIuZXJyb3IoYFB5dGhvbiBzdGRlcnI6ICR7Y2h1bmt9YCk7XG4gICAgICAgIGVycm9yT3V0cHV0ICs9IGNodW5rO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNoaWxkLm9uKCdlcnJvcicsIChlcnI6IEVycm9yKSA9PiB7XG4gICAgICAgIExvZ2dlci5lcnJvcihcIlByb2Nlc3MgZXJyb3I6XCIsIGVycik7XG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNoaWxkLm9uKCdjbG9zZScsIChjb2RlOiBudW1iZXIpID0+IHtcbiAgICAgICAgTG9nZ2VyLmRlYnVnKGBQcm9jZXNzIGV4aXRlZCB3aXRoIGNvZGUgJHtjb2RlfWApO1xuICAgICAgICBpZiAoY29kZSA9PT0gMCkge1xuICAgICAgICAgIHJlc29sdmUob3V0cHV0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBlcnJvciA9IGBQcm9jZXNzIGV4aXRlZCB3aXRoIGNvZGUgJHtjb2RlfSR7ZXJyb3JPdXRwdXQgPyAnOiAnICsgZXJyb3JPdXRwdXQgOiAnJ31gO1xuICAgICAgICAgIExvZ2dlci5lcnJvcihlcnJvcik7XG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihlcnJvcikpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIExvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBzcGF3biBwcm9jZXNzOlwiLCBlcnIpO1xuICAgICAgcmVqZWN0KGVycik7XG4gICAgfVxuICB9KTtcbn1cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFBsdWdpbiBpbXBsZW1lbnRhdGlvblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVkaXROZXh0UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3M6IEVkaXROZXh0UGx1Z2luU2V0dGluZ3MgPSBERUZBVUxUX1NFVFRJTkdTO1xuXG4gIGFzeW5jIG9ubG9hZCgpIHtcbiAgICBMb2dnZXIuaW5mbygnTG9hZGluZyBFZGl0TmV4dCBSYW5rZXIgcGx1Z2luJyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIExvZyBwbHVnaW4gZGV0YWlsc1xuICAgICAgTG9nZ2VyLmRlYnVnKFwiUGx1Z2luIGRpcmVjdG9yeTpcIiwgdGhpcy5tYW5pZmVzdC5kaXIpO1xuICAgICAgTG9nZ2VyLmRlYnVnKFwiUGx1Z2luIHZlcnNpb246XCIsIHRoaXMubWFuaWZlc3QudmVyc2lvbik7XG4gICAgICBcbiAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG4gICAgICBMb2dnZXIuZGVidWcoXCJTZXR0aW5ncyBsb2FkZWQ6XCIsIHRoaXMuc2V0dGluZ3MpO1xuXG4gICAgICAvLyBSZWdpc3RlciBjb21tYW5kXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICBpZDogJ2VkaXRuZXh0LXJhbmstZmlsZXMnLFxuICAgICAgICBuYW1lOiAnUmFuayBmaWxlcyBieSBlZGl0aW5nIGVmZm9ydCcsXG4gICAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgTG9nZ2VyLmluZm8oJ1J1bm5pbmcgRWRpdE5leHQgcmFua2VyIGNvbW1hbmQuLi4nKTtcbiAgICAgICAgICBuZXcgTm90aWNlKCdSdW5uaW5nIEVkaXROZXh0IHJhbmtlci4uLicpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBydW5SYW5rZXIodGhpcy5hcHAsIHRoaXMuc2V0dGluZ3MpO1xuICAgICAgICAgICAgTG9nZ2VyLmRlYnVnKFwiUmFua2VyIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHlcIik7XG4gICAgICAgICAgICAvLyBTaG93IG91dHB1dCBpbiBhIG5ldyBwYW5lXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYodHJ1ZSk7XG4gICAgICAgICAgICBhd2FpdCBsZWFmLm9wZW4obmV3IEVkaXROZXh0UmVzdWx0VmlldyhsZWFmLCByZXN1bHQpKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yTXNnID0gKGVyciBhcyBFcnJvcikubWVzc2FnZTtcbiAgICAgICAgICAgIExvZ2dlci5lcnJvcihcIlJhbmtlciBlcnJvcjpcIiwgZXJyKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYEVkaXROZXh0IGVycm9yOiAke2Vycm9yTXNnfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgc2V0dGluZ3MgdGFiXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IEVkaXROZXh0U2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuICAgICAgXG4gICAgICBMb2dnZXIuaW5mbygnRWRpdE5leHQgUmFua2VyIHBsdWdpbiBsb2FkZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBMb2dnZXIuZXJyb3IoXCJFcnJvciBkdXJpbmcgcGx1Z2luIGxvYWQ6XCIsIGVycik7XG4gICAgICB0aHJvdyBlcnI7IC8vIFJlLXRocm93IHRvIGxldCBPYnNpZGlhbiBoYW5kbGUgaXRcbiAgICB9XG4gIH1cblxuICBvbnVubG9hZCgpIHtcbiAgICBMb2dnZXIuaW5mbygnVW5sb2FkaW5nIEVkaXROZXh0IFJhbmtlciBwbHVnaW4nKTtcbiAgfVxuXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2F2ZWREYXRhID0gYXdhaXQgdGhpcy5sb2FkRGF0YSgpO1xuICAgICAgTG9nZ2VyLmRlYnVnKFwiTG9hZGVkIHNhdmVkIGRhdGE6XCIsIHNhdmVkRGF0YSk7XG4gICAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgc2F2ZWREYXRhKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIExvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBsb2FkIHNldHRpbmdzOlwiLCBlcnIpO1xuICAgICAgdGhpcy5zZXR0aW5ncyA9IHsgLi4uREVGQVVMVF9TRVRUSU5HUyB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICAgIExvZ2dlci5kZWJ1ZyhcIlNldHRpbmdzIHNhdmVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIExvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBzYXZlIHNldHRpbmdzOlwiLCBlcnIpO1xuICAgIH1cbiAgfVxufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gVmlldyB0byBkaXNwbGF5IHJlc3VsdHMgKHNpbXBsZSBtYXJrZG93biB2aWV3KVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmltcG9ydCB7IEl0ZW1WaWV3LCBXb3Jrc3BhY2VMZWFmIH0gZnJvbSAnb2JzaWRpYW4nO1xuY29uc3QgVklFV19UWVBFID0gJ2VkaXRuZXh0LXJlc3VsdHMnO1xuXG5jbGFzcyBFZGl0TmV4dFJlc3VsdFZpZXcgZXh0ZW5kcyBJdGVtVmlldyB7XG4gIHJlc3VsdFRleHQ6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihsZWFmOiBXb3Jrc3BhY2VMZWFmLCB0ZXh0OiBzdHJpbmcpIHtcbiAgICBzdXBlcihsZWFmKTtcbiAgICB0aGlzLnJlc3VsdFRleHQgPSB0ZXh0O1xuICB9XG5cbiAgZ2V0Vmlld1R5cGUoKSB7XG4gICAgcmV0dXJuIFZJRVdfVFlQRTtcbiAgfVxuXG4gIGdldERpc3BsYXlUZXh0KCkge1xuICAgIHJldHVybiAnRWRpdE5leHQgUmVzdWx0cyc7XG4gIH1cblxuICBhc3luYyBvbk9wZW4oKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5jb250YWluZXJFbC5jaGlsZHJlblsxXTtcbiAgICBjb250YWluZXIuZW1wdHkoKTtcbiAgICBjb25zdCBwcmUgPSBjb250YWluZXIuY3JlYXRlRWwoJ3ByZScpO1xuICAgIHByZS5zdHlsZS53aGl0ZVNwYWNlID0gJ3ByZS13cmFwJztcbiAgICBwcmUuc2V0VGV4dCh0aGlzLnJlc3VsdFRleHQpO1xuICB9XG5cbiAgYXN5bmMgb25DbG9zZSgpIHt9XG59XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBTZXR0aW5ncyBUYWIgVUlcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5jbGFzcyBFZGl0TmV4dFNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgcGx1Z2luOiBFZGl0TmV4dFBsdWdpbjtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBFZGl0TmV4dFBsdWdpbikge1xuICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICBMb2dnZXIuZGVidWcoXCJTZXR0aW5ncyB0YWIgaW5pdGlhbGl6ZWRcIik7XG4gIH1cblxuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgTG9nZ2VyLmRlYnVnKFwiU2V0dGluZ3MgdGFiIGRpc3BsYXllZFwiKTtcblxuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdFZGl0TmV4dCBSYW5rZXIgU2V0dGluZ3MnIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnT3BlbkFJIEFQSSBLZXknKVxuICAgICAgLnNldERlc2MoJ1JlcXVpcmVkIHRvIHF1ZXJ5IEdQVCBtb2RlbHMnKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ3NrLVhYWFgnKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5vcGVuYWlBcGlLZXkpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Mub3BlbmFpQXBpS2V5ID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKCdQeXRob24gUGF0aCcpXG4gICAgICAuc2V0RGVzYygnUGF0aCB0byBQeXRob24gZXhlY3V0YWJsZSAod2l0aCBkZXBlbmRlbmNpZXMgaW5zdGFsbGVkKScpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcigncHl0aG9uMycpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnB5dGhvblBhdGgpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucHl0aG9uUGF0aCA9IHZhbHVlLnRyaW0oKSB8fCAncHl0aG9uMyc7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ1dlaWdodHMnKVxuICAgICAgLnNldERlc2MoJ1RocmVlIG51bWJlcnMgZm9yIExMTSwgR3JhbW1hciwgUmVhZGFiaWxpdHkgd2VpZ2h0cyAoc3VtIDEuMCknKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJzAuNiAwLjIgMC4yJylcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Mud2VpZ2h0cy5qb2luKCcgJykpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGFydHMgPSB2YWx1ZS5zcGxpdCgvXFxzKy8pLm1hcChOdW1iZXIpO1xuICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMyAmJiBwYXJ0cy5ldmVyeSgobikgPT4gIWlzTmFOKG4pKSkge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy53ZWlnaHRzID0gcGFydHMgYXMgW251bWJlciwgbnVtYmVyLCBudW1iZXJdO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ09wZW5BSSBNb2RlbCcpXG4gICAgICAuc2V0RGVzYygnTW9kZWwgdG8gdXNlIGZvciBzY29yaW5nJylcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxuICAgICAgICB0ZXh0LnNldFBsYWNlaG9sZGVyKCdncHQtNG8tbWluaScpLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm1vZGVsKS5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tb2RlbCA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKCdUYXJnZXQgRm9sZGVyJylcbiAgICAgIC5zZXREZXNjKCdSZWxhdGl2ZSBwYXRoIGluc2lkZSB2YXVsdDsgbGVhdmUgYmxhbmsgZm9yIGVudGlyZSB2YXVsdCcpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignZHJhZnRzJylcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudGFyZ2V0Rm9sZGVyKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRhcmdldEZvbGRlciA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICB9XG59ICJdLCJuYW1lcyI6WyJub3JtYWxpemVQYXRoIiwic3Bhd24iLCJQbHVnaW4iLCJOb3RpY2UiLCJJdGVtVmlldyIsIlBsdWdpblNldHRpbmdUYWIiLCJTZXR0aW5nIl0sIm1hcHBp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
